import pytest
import numpy as np
import logging
from typing import Optional, Union

from core.dsl_symbolic_interpreter import SymbolicRuleParser, roman_to_int
from core.dsl_symbolic_executor import DSLExecutor
from core.dsl_nodes import InputGridReference


logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(name)s - %(levelname)s - %(message)s')


common_input_grid = np.array([
    [1, 2, 3],
    [4, 5, 6],
    [7, 8, 9]
], dtype=int)

asymmetric_grid = np.array([
    [1, 2, 0],
    [3, 4, 0],
    [0, 0, 0]
], dtype=int)

tiny_grid_1x1_val1 = np.array([[1]], dtype=int)
tiny_grid_1x1_val2 = np.array([[2]], dtype=int)




TEST_CASES = [
    ("Ⳁ", tiny_grid_1x1_val1, tiny_grid_1x1_val1),
    ("Ⳁ", np.array([[0, 0], [0, 0]]), np.array([[0, 0], [0, 0]])),
    ("Ⳁ", np.array([1, 2, 3]), np.array([1, 2, 3])),

    ("⇒(II, I)", np.array([[1, 2, 3], [2, 0, 2]]), np.array([[1, 1, 3], [1, 0, 1]])),
    ("⇒(∅, III)", np.array([[0, 1], [0, 0]]), np.array([[3, 1], [3, 3]])),
    ("⇒(I, I)", np.array([[1, 2], [3, 1]]), np.array([[1, 2], [3, 1]])),

    ("↔", tiny_grid_1x1_val1, tiny_grid_1x1_val1),
    ("↔", np.array([[1, 2, 3]]), np.array([[3, 2, 1]])),
    ("↔", np.array([[1], [2], [3]]), np.array([[1], [2], [3]])),

    ("→(I, Ⳁ)", np.array([[1, 2], [3, 4]]), np.array([[1, 2], [3, 4]])),
    ("→(II, Ⳁ)", np.array([[1, 2], [3, 4]]), np.array([[1, 2], [3, 4]])),
    ("→(I, ⇒(I, ∅))", np.array([[1, 1], [1, 1]]), np.array([[0, 0], [1, 1]])),

    ("↻(I)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[3, 1], [4, 2]], dtype=int)),
    ("↻(II)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[4, 3], [2, 1]], dtype=int)),
    ("↻(III)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[2, 4], [1, 3]], dtype=int)),
    ("↻(I, ↔)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[4, 2], [3, 1]], dtype=int)), # Flip H, then 90 deg CW
    ("↻(II, ↕)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[2, 1], [4, 3]], dtype=int)), # Flip V, then 180 deg CW
    ("↻(I, ▦(II,II,[[I,∅],[∅,I]]))", None, np.array([[0, 1], [1, 0]], dtype=int)),
    ("↻(II, ⟹(◎(I), ⇒(I,I)))", np.array([[1, 5], [5, 1]], dtype=int), np.array([[1, 0], [0, 1]], dtype=int)),
    ("↻(III, ∧(⊕(II,II,I), ▦(II,II,[[I,∅],[∅,I]])))", None, np.array([[0, 1], [1, 0]], dtype=int)),
    ("↻(I, ⌂)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[3, 1], [4, 2]], dtype=int)),
    ("↓(I, ↕)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[3, 2], [1, 4]], dtype=int)),
    ("⟹(↓(I,↕),↕)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[1, 4], [3, 2]], dtype=int)),
    ("↓(II, ↕)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[1, 4], [3, 2]], dtype=int)),
    ("↓(I, Ⳁ)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[1, 2], [3, 4]], dtype=int)),
    ("↓(II, Ⳁ)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[1, 2], [3, 4]], dtype=int)),
    ("↓(I, ⇒(I, ∅))", np.array([[1, 1], [1, 1]], dtype=int), np.array([[0, 1], [0, 1]], dtype=int)),
    
    ("⟹(↔, ↕)", np.array([[1, 2], [3, 4]]), np.array([[4, 3], [2, 1]])),
    ("⟹(↔, ↔)", np.array([[1, 2, 3]]), np.array([[1, 2, 3]])),

    ("⬒(I)", np.array([[1, 2]]), np.array([[1, 2]])),
    ("⬒(III)", tiny_grid_1x1_val1, np.array([[1], [1], [1]])),


    ("⇅(I,II)", np.array([[1, 2], [3, 4]]), np.array([[3, 4], [1, 2]])),
    ("⇅(I,IV)", np.array([[1, 1, 1], [2, 2, 2], [3, 3, 3], [4, 4, 4]]), np.array([[4, 4, 4], [2, 2, 2], [3, 3, 3], [1, 1, 1]])),
    ("⇅(I,I)", np.array([[1, 2, 3], [4, 5, 6]]), np.array([[1, 2, 3], [4, 5, 6]])),
    
    ("⇆(I,II)", np.array([[1, 2], [3, 4]]), np.array([[2, 1], [4, 3]])),
    ("⇆(I,IV)", np.array([[1, 2, 3, 4], [5, 6, 7, 8]]), np.array([[4, 2, 3, 1], [8, 6, 7, 5]])),
    ("⇆(I,I)", np.array([[1], [2], [3]]), np.array([[1], [2], [3]])),
    
    ("⮝(I,I)", np.array([[1, 2, 3, 4]]), np.array([[4, 1, 2, 3]])),
    ("⮝(I,∅)", np.array([[1, 2, 3]]), np.array([[1, 2, 3]])),
    ("⮝(V,I)", np.array([[1],[2],[3],[4],[5]]), np.array([[1],[2],[3],[4],[5]])),

    ("↕", tiny_grid_1x1_val1, tiny_grid_1x1_val1),
    ("↕", np.array([[1, 2]]), np.array([[1, 2]])),
    ("↕", np.array([[1], [2], [3]]), np.array([[3], [2], [1]])),

    ("⮞(I,I)", np.array([[1, 2], [3, 4]]), np.array([[3, 2], [1, 4]])),
    ("⮞(I,∅)", np.array([[1, 2], [3, 4]]), np.array([[1, 2], [3, 4]])),
    ("⮞(III,II)", np.array([[1,2,3,4],[5,6,7,8]]), np.array([[1,2,3,4],[5,6,7,8]])),

    ("◨(I)", np.array([[1], [2]]), np.array([[1], [2]])),
    ("◨(IV)", tiny_grid_1x1_val1, np.array([[1, 1, 1, 1]])),

    ("⊕(I,V,I)", None, np.array([[1, 1, 1, 1, 1]], dtype=int)), # Added dtype
    ("⊕(V,I,II)", None, np.array([[2], [2], [2], [2], [2]], dtype=int)), # Added dtype

    ("⤨(I)", np.array([[1, 2], [3, 4]]), np.array([[1, 2], [3, 4]])),
    ("⤨(IV)", np.array([[0, 1]]), np.array([[0,0,0,0,1,1,1,1],[0,0,0,0,1,1,1,1],[0,0,0,0,1,1,1,1],[0,0,0,0,1,1,1,1]])),

    ("⧈", np.array([[1, 1, 1]]), np.array([[1, 1, 1]])),
    ("⧈", np.array([[0, 0, 0], [0, 5, 0], [0, 0, 0]]), np.array([[5]])),
    ("⧈", np.array([[0, 0], [1, 0]]), np.array([[1]])),

    ("⧀", tiny_grid_1x1_val1, np.array([1])),
    ("⧀", np.array([[]]).reshape(0,0), np.array([]).reshape(0,)),

    ("⊡(I,I)", tiny_grid_1x1_val1, np.array([[1]])),
    ("⊡(I,III)", np.array([[1, 2, 3, 4], [5, 6, 7, 8]]), np.array([[3]])),
    ("⊡(II,I)", np.array([[1, 2], [3, 4]]), np.array([[3]])),

    ("↱I", None, 1),
    ("↱∅", None, 0),
    ("↱X", None, 10),

    ("≡(⊡(II,II), ⊡(I,I))", np.array([[1, 2], [1, 1]]), np.array([[1]])),
    ("≡(⊡(II,II), ⊡(I,I))", np.array([[1, 2], [3, 4]]), np.array([[0]])),
    ("≡(⊕(I,I,I), ⊡(I,I))", tiny_grid_1x1_val1, np.array([[1]])),

    ("≗(↔, ↔)", np.array([[1, 2], [3, 4]]), np.array([[1]])),
    ("≗(⬒(II), ◨(II))", tiny_grid_1x1_val1, np.array([[0]])),
    ("≗(⬒(II), ⬒(II))", np.array([[1, 2]]), np.array([[1]])),

    ("⍰(≡(⊕(I,I,V), ⊕(I,I,V)), ↔, ↕)", np.array([[1, 2], [3, 4]]), np.array([[2, 1], [4, 3]])),
    ("⍰(≡(⊕(I,I,V), ⊕(I,I,IX)), ↔, ↕)", np.array([[1, 2], [3, 4]]), np.array([[3, 4], [1, 2]])),
    ("⍰(≡(⊕(I,I,∅), ⊕(I,I,I)), Ⳁ, ⤨(II))", tiny_grid_1x1_val1, np.array([[1, 1], [1, 1]])),

    # --- Corrected ▦ test cases ---
    ("▦(I,I,[[I]])", None, np.array([[1]], dtype=int)),
    ("▦(I,I,[[∅]])", None, np.array([[0]], dtype=int)),
    ("▦(I,II,[[I,∅]])", None, np.array([[1, 0]], dtype=int)),
    ("▦(II,I,[[I],[I]])", None, np.array([[1],[1]], dtype=int)),
    ("▦(II,II,[[I,∅],[∅,I]])", None, np.array([[1,0],[0,1]], dtype=int)),
    ("▦(II,III,[[I,∅,I],[∅,I,∅]])", None, np.array([[1,0,1],[0,1,0]], dtype=int)),
    ("▦(III,III,[[∅,∅,I],[∅,II,I],[I,∅,∅]])", None, np.array([[0, 0, 1], [0, 2, 1], [1, 0, 0]], dtype=int)),
    ("▦(IV,IV,[[I,∅,I,∅],[∅,I,∅,I],[I,∅,I,∅],[∅,I,∅,I]])", None, np.array([
        [1,0,1,0],
        [0,1,0,1],
        [1,0,1,0],
        [0,1,0,1]
    ], dtype=int)),
    ("▦(V,V,[[I,∅,I,∅,I],[∅,I,∅,I,∅],[I,∅,I,∅,I],[∅,I,∅,I,∅],[I,∅,I,∅,I]])", None, np.array([
        [1,0,1,0,1],
        [0,1,0,1,0],
        [1,0,1,0,1],
        [0,1,0,1,0],
        [1,0,1,0,1]
    ], dtype=int)),
    # --- End of corrected ▦ test cases ---

    ("⧎(⊕(I,I,I), ⊕(I,I,I), ⊕(I,I,∅))", None, np.array([[1]])),
    ("⧎(⊕(II,II,V), ▦(II,II,[[I,∅],[∅,I]]), ⊕(II,II,I))", None, np.array([[5, 1], [1, 5]])),
    ("⧎(Ⳁ, ⊕(II,II,∅), ⊕(II,II,IX))", np.array([[1, 2], [3, 4]]), np.array([[9, 9], [9, 9]])),

    ("¿(↕, ≡(⊡(I,I), ↱V))", np.array([[1,2],[5,6]]), np.array([[1,2],[5,6]])),
    ("¿(↕, ≡(⊡(II,I), ↱V))", np.array([[1,2],[5,6]]), np.array([[5,6],[1,2]])),
    ("¿(⤨(II), ≗(Ⳁ,Ⳁ))", tiny_grid_1x1_val1, np.array([[1,1],[1,1]])),

    ("◎(III)", np.array([[1,2,3],[3,2,1]]), np.array([[0,0,3],[3,0,0]])),
    ("◎(I)", np.array([[1,1],[1,1]]), np.array([[1,1],[1,1]])),
    ("◎(V)", np.array([[1,2],[3,4]]), np.array([[0,0],[0,0]])),
    
    ("Ⳁ", np.array([[1, 0], [0, 1]], dtype=int), np.array([[1, 0], [0, 1]], dtype=int)),
    ("⇒(I,∅)", np.array([[1, 8], [0, 1]], dtype=int), np.array([[0, 8], [0, 0]], dtype=int)),
    ("↔", np.array([[1, 2], [3, 4]], dtype=int), np.array([[2, 1], [4, 3]], dtype=int)),
    ("→(I, ↔)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[2, 1], [3, 4]], dtype=int)),
    ("⟹(→(I,↔),↔)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[1, 2], [4, 3]], dtype=int)),
    ("⬒(II)",  np.array([[1, 0], [0, 1]], dtype=int), np.tile( np.array([[1, 0], [0, 1]], dtype=int), (2, 1))),
    ("⮝(I,II)", np.array([[1, 2, 3], [4, 5, 6]], dtype=int), np.array([[2, 3, 1], [4, 5, 6]], dtype=int)),
    ("↕", np.array([[1, 2], [3, 4]], dtype=int), np.array([[3, 4], [1, 2]], dtype=int)),
    ("↕", np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]], dtype=int), np.array([[7, 8, 9], [4, 5, 6], [1, 2, 3]], dtype=int)),
    ("⮞(I,II)", np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]], dtype=int), np.array([[4, 2, 3], [7, 5, 6], [1, 8, 9]], dtype=int)),
    ("⮞(II,I)", np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]], dtype=int), np.array([[1, 8, 3], [4, 2, 6], [7, 5, 9]], dtype=int)),
    ("◨(II)", np.array([[1, 0], [0, 1]], dtype=int), np.tile(np.array([[1, 0], [0, 1]], dtype=int), (1, 2))),
    ("◨(III)", np.array([[1, 2]], dtype=int), np.array([[1, 2, 1, 2, 1, 2]], dtype=int)),
    ("→(II, ↔)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[1, 2], [4, 3]], dtype=int)),
    ("→(I, Ⳁ)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[1, 2], [3, 4]], dtype=int)),
    ("⮝(I,I)", np.array([[1, 2, 3], [4, 5, 6]], dtype=int), np.array([[3, 1, 2], [4, 5, 6]], dtype=int)),
    ("⮝(II,I)", np.array([[1, 2, 3], [4, 5, 6]], dtype=int), np.array([[1, 2, 3], [6, 4, 5]], dtype=int)),
    ("⟹(↔)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[2, 1], [4, 3]], dtype=int)),
    ("⟹(⮝(I,I), ↔, ⬒(II))", np.array([[1, 2], [3, 4]], dtype=int), np.tile(np.array([[1, 2], [4, 3]], dtype=int), (2, 1))),
    ("⊕(IV,IV,∅)", np.zeros((4,4), dtype=int), np.array([[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]], dtype=int)),
    ("⟹(◨(II), ⬒(II))", np.array([[0, 1], [1, 0]], dtype=int), np.array([[0,1,0,1],[1,0,1,0],[0,1,0,1],[1,0,1,0]], dtype=int)),
    ("⧎(⟹(◨(II), ⬒(II)), ⤨(II), ⊕(IV,IV,∅))", np.array([[0, 1], [1, 0]], dtype=int), np.array([[0,0,0,1],[0,0,1,0],[0,1,0,0],[1,0,0,0]], dtype=int)),
    ("⌂", np.array([[5, 6], [7, 8]], dtype=int), np.array([[5, 6], [7, 8]], dtype=int)),
    ("⌂", np.array([[1, 1, 1], [0, 0, 0]], dtype=int), np.array([[1, 1, 1], [0, 0, 0]], dtype=int)),
    ("↔(⌂)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[2, 1], [4, 3]], dtype=int)),
    ("↔(⌂)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[2, 1], [4, 3]], dtype=int)),
    ("↔(⌂)", np.array([[1, 2, 3], [4, 5, 6]], dtype=int), np.array([[3, 2, 1], [6, 5, 4]], dtype=int)),
    ("↕(⌂)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[3, 4], [1, 2]], dtype=int)),
    ("↕(⌂)", np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]], dtype=int), np.array([[7, 8, 9], [4, 5, 6], [1, 2, 3]], dtype=int)),
    ("⧈(⌂)", np.array([[0, 0, 0, 0], [0, 1, 1, 0], [0, 1, 0, 0], [0, 0, 0, 0]], dtype=int), np.array([[1, 1], [1, 0]], dtype=int)),
    ("⧈(⌂)", np.array([[0, 0], [0, 0]], dtype=int), np.array([[0]], dtype=int)),
    ("⧀(⌂)", np.array([[1, 2], [3, 4]], dtype=int), np.array([1, 2, 3, 4], dtype=int)),
    ("⧀(⌂)", np.array([[5], [6], [7]], dtype=int), np.array([5, 6, 7], dtype=int)),
    ("⟹(⌂, ⤨(II))", np.array([[1, 2], [3, 4]], dtype=int), np.array([[1, 1, 2, 2], [1, 1, 2, 2], [3, 3, 4, 4], [3, 3, 4, 4]], dtype=int)),
    ("⟹(⌂, ⤨(III))", np.array([[1]], dtype=int), np.array([[1, 1, 1], [1, 1, 1], [1, 1, 1]], dtype=int)),
    ("⟹(⌂, ⇒(I,V))", np.array([[1, 2], [3, 1]], dtype=int), np.array([[5, 2], [3, 5]], dtype=int)),
    ("⟹(⌂, ⇒(V,∅))", np.array([[5, 5], [0, 0]], dtype=int), np.array([[0, 0], [0, 0]], dtype=int)),
    ("⇌(↔, ↕)", common_input_grid, np.array([[3, 2, 1], [4, 5, 6], [9, 8, 7]], dtype=int)),
    ("⇌(↔, Ⳁ)", common_input_grid, np.array([[3, 2, 1], [4, 5, 6], [9, 8, 7]], dtype=int)),
    ("⇌(⇒(I,∅), ↔)", asymmetric_grid, np.array([[0, 2, 0], [0, 4, 3], [0, 0, 0]], dtype=int)),
    ("¿(↔, ≗(⊕(I,I,I), ⊕(I,I,I)))", common_input_grid, np.fliplr(common_input_grid)),
    ("¿(↔, ≗(⊡(I,I), ⊕(I,I,I)))", common_input_grid, np.fliplr(common_input_grid)), 
    ("¿(↔, ≗(⊡(I,I), ⊕(I,I,V)))", common_input_grid, common_input_grid),
    ("¿(↔, ≗(⌂, Ⳁ))", common_input_grid, np.flip(common_input_grid, axis=1)),
    ("¿(↔, ≗(⌂, ↔(⌂)))", asymmetric_grid, asymmetric_grid),
    ("◫(⌂, [(⊕(I,I,I), ↔)], Ⳁ)", tiny_grid_1x1_val1, tiny_grid_1x1_val1),
    ("◫(⌂, [(⊕(I,I,II), ↔)], Ⳁ)", tiny_grid_1x1_val1, tiny_grid_1x1_val1),
    ("◫(⌂, [(⊕(II,II,I), ↔)], ↕)", np.array([[1,1],[1,1]], dtype=int), np.array([[1,1],[1,1]], dtype=int)), 
    ("◫(⌂, [(⊕(II,II,II), ↔)], ↕)", asymmetric_grid, np.flipud(asymmetric_grid)),
    ("⟹(⇒(VIII, VII), ⇒(I, ∅))", np.array([[8, 8, 0, 0], [8, 0, 0, 1], [0, 0, 1, 1], [0, 0, 0, 0]], dtype=int), np.array([[7, 7, 0, 0], [7, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], dtype=int)),
    ("◎(I)", common_input_grid, np.array([[1, 0, 0], [0, 0, 0], [0, 0, 0]], dtype=int)),
    ("◎(V)", common_input_grid, np.array([[0, 0, 0], [0, 5, 0], [0, 0, 0]], dtype=int)),
    ("◎(∅)", common_input_grid, np.zeros_like(common_input_grid, dtype=int)),
    ("◎(IX)", common_input_grid, np.array([[0, 0, 0], [0, 0, 0], [0, 0, 9]], dtype=int)),    ("◎(I)", tiny_grid_1x1_val1, tiny_grid_1x1_val1),
    ("◎(II)", tiny_grid_1x1_val1, np.array([[0]], dtype=int)),
    ("⧎(⊕(II,II,∅), ▦(II,II,[[I,∅],[∅,I]]), ↱I)", None, np.array([[0, 1], [1, 0]], dtype=int)),
    ("⧎(⊕(III,III,VII), ▦(III,III,[[I,∅,I],[∅,I,∅],[I,∅,I]]), ⊕(III,III,∅))", None, np.array([[7, 0, 7], [0, 7, 0], [7, 0, 7]], dtype=int)),
    
    ("◫(⌂, [(▦(IV,IV,[[I,∅,I,∅],[∅,I,∅,I],[I,∅,I,∅],[∅,I,∅,I]]), ⇒(I, VII))], ⇒(I, V))", np.array([[1,0,1,0],[0,1,0,1],[1,0,1,0],[0,1,0,1]], dtype=int), np.array([[7,0,7,0],[0,7,0,7],[7,0,7,0],[0,7,0,7]], dtype=int)),
    ("◫(⌂, [(▦(IV,IV,[[I,∅,I,∅],[∅,I,∅,I],[I,∅,I,∅],[∅,I,∅,I]]), ⇒(I, VII))], ⇒(I, V))", np.array([[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]], dtype=int), np.array([[5,5,5,5],[5,5,5,5],[5,5,5,5],[5,5,5,5]], dtype=int)),
    ("⧈(◎(I))", np.array([[0, 0, 0, 0, 0], [0, 0, 1, 0, 0], [0, 1, 1, 1, 0], [0, 0, 1, 0, 0], [0, 0, 0, 0, 0]], dtype=int), np.array([[0, 1, 0], [1, 1, 1], [0, 1, 0]], dtype=int)),
    ("◫(⧈(◎(I)), [(▦(III,III,[[∅,I,∅],[I,I,I],[∅,I,∅]]), ⇒(VIII, III))], ⇒(∅, V))", np.array([[8, 0, 0, 0, 8], [0, 0, 1, 0, 0], [8, 1, 1, 1, 8], [0, 0, 1, 0, 0], [8, 0, 0, 0, 8]], dtype=int), np.array([[3, 0, 0, 0, 3], [0, 0, 1, 0, 0], [3, 1, 1, 1, 3], [0, 0, 1, 0, 0], [3, 0, 0, 0, 3]], dtype=int)),
    ("◫(⧈(◎(I)), [(▦(III,III,[[∅,I,∅],[I,I,I],[∅,I,∅]]), ⇒(VIII, III))], ⇒(∅, V))", np.array([[8, 0, 0, 0, 8], [0, 1, 0, 0, 0], [8, 1, 1, 1, 8], [0, 0, 1, 0, 0], [8, 0, 0, 0, 8]], dtype=int), np.array([[8, 5, 5, 5, 8], [5, 1, 5, 5, 5], [8, 1, 1, 1, 8], [5, 5, 1, 5, 5], [8, 5, 5, 5, 8]], dtype=int)),
    ("◫(⧈(◎(I)), [(▦(III,III,[[∅,I,∅],[I,I,I],[∅,I,∅]]), ⟹(⇒(VIII, III), ⇒(I, ∅)))], ⟹(⇒(∅, V), ⇒(I, ∅)))", np.array([[8, 0, 0, 0, 8], [0, 0, 1, 0, 0], [8, 1, 1, 1, 8], [0, 0, 1, 0, 0], [8, 0, 0, 0, 8]], dtype=int), np.array([[3, 0, 0, 0, 3], [0, 0, 0, 0, 0], [3, 0, 0, 0, 3], [0, 0, 0, 0, 0], [3, 0, 0, 0, 3]], dtype=int)),
    ("◫(⧈(◎(I)), [(▦(III,III,[[∅,I,∅],[I,I,I],[∅,I,∅]]), ⟹(⇒(VIII, III), ⇒(I, ∅)))], ⟹(⇒(∅, V), ⇒(I, ∅)))", np.array([[8, 0, 0, 0, 8], [0, 1, 0, 0, 0], [8, 1, 1, 1, 8], [0, 0, 1, 0, 0], [8, 0, 0, 0, 8]], dtype=int), np.array([[8, 5, 5, 5, 8], [5, 0, 5, 5, 5], [8, 0, 0, 0, 8], [5, 5, 0, 5, 5], [8, 5, 5, 5, 8]], dtype=int)),
    ("⏚(∅)", np.array([[0, 0, 0], [0, 1, 0], [0, 0, 0]]), np.array([[1, 1, 1], [1, 0, 1], [1, 1, 1]])),
    ("⏚(∅)", np.array([[0,0],[0,0]]), np.array([[1,1],[1,1]])),
    ("⏚(∅)", np.array([[0,1,0],[1,1,1],[0,1,0]]), np.array([[1,0,1],[0,0,0],[1,0,1]])),
    ("⏚(V)", np.array([[5,1,5],[1,2,1],[5,1,5]]), np.array([[1,0,1],[0,0,0],[1,0,1]])),
    ("⏚(∅)", np.array([[0,0,0],[0,7,0],[0,0,0]]), np.array([[1,1,1],[1,0,1],[1,1,1]])),
    ("⏚(∅)", np.array([
        [0,0,0,0,0,0],
        [0,1,1,1,1,0],
        [0,1,1,1,1,0],
        [0,1,1,1,1,0],
        [0,0,0,0,0,0]
    ]), np.array([
        [1,1,1,1,1,1],
        [1,0,0,0,0,1],
        [1,0,0,0,0,1],
        [1,0,0,0,0,1],
        [1,1,1,1,1,1]
    ])),

    ("⟹(⏚(∅), ⟹(⟹(⇒(∅, IX), ⇒(I, ∅)), ⇒(IX, I)))", np.array([[0,0,0,0,0],[0,5,5,5,0],[0,5,0,5,0],[0,5,5,5,0],[0,0,0,0,0]], dtype=int), np.array([[0,0,0,0,0],[0,1,1,1,0],[0,1,1,1,0],[0,1,1,1,0],[0,0,0,0,0]], dtype=int)),
    ("¬(⊕(I,I,I))", None, np.array([[0]], dtype=int)),
    ("¬(⊕(I,I,∅))", None, np.array([[1]], dtype=int)),
    ("¬(⊕(II,II,I))", None, np.array([[0, 0], [0, 0]], dtype=int)),
    ("¬(⊕(II,II,∅))", None, np.array([[1, 1], [1, 1]], dtype=int)),
    ("¬(▦(II,II,[[I,∅],[∅,I]]))", None, np.array([[0, 1], [1, 0]], dtype=int)),
    ("¬(⟹(◎(V), ⇒(V,I)))", np.array([[1, 5], [5, 1]], dtype=int), np.array([[1, 0], [0, 1]], dtype=int)),
    ("¬(⟹(◎(I), ⇒(I,I)))", np.array([[1, 5], [5, 1]], dtype=int), np.array([[0, 1], [1, 0]], dtype=int)),
    ("∧(⊕(I,I,I), ⊕(I,I,I))", None, np.array([[1]], dtype=int)),
    ("∧(⊕(I,I,I), ⊕(I,I,∅))", None, np.array([[0]], dtype=int)),
    ("∧(⊕(II,II,I), ⊕(II,II,∅))", None, np.array([[0, 0], [0, 0]], dtype=int)),
    ("∧(⊕(II,II,I), ▦(II,II,[[I,∅],[∅,I]]))", None, np.array([[1, 0], [0, 1]], dtype=int)),
    ("∧(▦(II,II,[[I,∅],[∅,I]]), ▦(II,II,[[I,∅],[I,∅]]))", None, np.array([[1, 0], [0, 0]], dtype=int)),
    ("∧(⟹(◎(I), ⇒(I,I)), ⟹(◎(V), ⇒(V,I)))", np.array([[1, 5], [5, 1]], dtype=int), np.array([[0, 0], [0, 0]], dtype=int)),
    ("∧(⟹(◎(I), ⇒(I,I)), ⟹(◎(I), ⇒(I,I)))", np.array([[1, 5], [5, 1]], dtype=int), np.array([[1, 0], [0, 1]], dtype=int)),
    ("∨(⊕(I,I,I), ⊕(I,I,I))", None, np.array([[1]], dtype=int)),
    ("∨(⊕(I,I,I), ⊕(I,I,∅))", None, np.array([[1]], dtype=int)),
    ("∨(⊕(I,I,∅), ⊕(I,I,∅))", None, np.array([[0]], dtype=int)),
    ("∨(⊕(II,II,I), ⊕(II,II,∅))", None, np.array([[1, 1], [1, 1]], dtype=int)),
    ("∨(⊕(II,II,∅), ▦(II,II,[[I,∅],[∅,I]]))", None, np.array([[1, 0], [0, 1]], dtype=int)),
    ("∨(▦(II,II,[[I,∅],[∅,I]]), ▦(II,II,[[I,∅],[I,∅]]))", None, np.array([[1, 0], [1, 1]], dtype=int)),
    ("∨(⟹(◎(I), ⇒(I,I)), ⟹(◎(V), ⇒(V,I)))", np.array([[1, 5], [5, 1]], dtype=int), np.array([[1, 1], [1, 1]], dtype=int)),
    ("∨(⟹(◎(I), ⇒(I,I)), ⟹(◎(II), ⇒(II,I)))", np.array([[1, 2], [3, 4]], dtype=int), np.array([[1, 1], [0, 0]], dtype=int)),
    
    ("⇒(∅, IV)", np.array([[0, 1, 0], [2, 0, 3]], dtype=int), np.array([[4, 1, 4], [2, 4, 3]], dtype=int)),
    ("⇒(∅, IV)", np.array([[0]], dtype=int), np.array([[4]], dtype=int)),
    ("⇒(∅, IV)", np.array([[1]], dtype=int), np.array([[1]], dtype=int)),
    ("◎(∅)", np.array([[3,3,3,3,3],[3,0,0,0,3],[3,0,3,0,3],[3,0,0,0,3],[3,3,3,3,3]], dtype=int), np.array([[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("◎(∅)", np.array([[0,0,0],[0,1,0],[0,0,0]], dtype=int), np.array([[0,0,0],[0,0,0],[0,0,0]], dtype=int)),
    ("◎(∅)", np.array([[1,2],[3,4]], dtype=int), np.array([[0,0],[0,0]], dtype=int)),
    ("⏚(∅)", np.array([[3,3,3,3,3],[3,0,0,0,3],[3,0,3,0,3],[3,0,0,0,3],[3,3,3,3,3]], dtype=int), np.array([[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("⏚(∅)", np.array([[0,0,0],[0,1,0],[0,0,0]], dtype=int), np.array([[1,1,1],[1,0,1],[1,1,1]], dtype=int)),
    ("⏚(∅)", np.array([[0,0],[0,0]], dtype=int), np.array([[1,1],[1,1]], dtype=int)),
    ("¬(⏚(∅))", np.array([[3,3,3,3,3],[3,0,0,0,3],[3,0,3,0,3],[3,0,0,0,3],[3,3,3,3,3]], dtype=int), np.array([[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]], dtype=int)),
    ("¬(⏚(∅))", np.array([[0,0,0],[0,1,0],[0,0,0]], dtype=int), np.array([[0,0,0],[0,1,0],[0,0,0]], dtype=int)),
    ("¬(Ⳁ)", np.array([[1,0],[0,1]], dtype=int), np.array([[0,1],[1,0]], dtype=int)),
    ("¬(Ⳁ)", np.array([[1,0],[5,0]], dtype=int), np.array([[0,1],[0,1]], dtype=int)),
    ("¬(◎(I))", np.array([[1,0],[5,1]], dtype=int), np.array([[0,1],[1,0]], dtype=int)),
    ("∧(◎(∅), ¬(⏚(∅)))", np.array([[3,3,3,3,3],[3,0,0,0,3],[3,0,3,0,3],[3,0,0,0,3],[3,3,3,3,3]], dtype=int), np.array([[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("∧(◎(∅), ¬(⏚(∅)))", np.array([[0,0,0],[0,1,0],[0,0,0]], dtype=int), np.array([[0,0,0],[0,0,0],[0,0,0]], dtype=int)),
    ("∧(Ⳁ, ¬(Ⳁ))", np.array([[1,0],[2,3]], dtype=int), np.array([[0,0],[0,0]], dtype=int)),
    ("∧(⊕(II,II,I), ▦(II,II,[[I,∅],[∅,I]]))", None, np.array([[1,0],[0,1]], dtype=int)),
    ("∧(Ⳁ, Ⳁ)", np.array([[1,0],[2,3]], dtype=int), np.array([[1,0],[1,1]], dtype=int)),
    ("⧎(⇒(∅, IV), ∧(◎(∅), ¬(⏚(∅))), Ⳁ)", np.array([[3,3,3,3,3],[3,0,0,0,3],[3,0,3,0,3],[3,0,0,0,3],[3,3,3,3,3]], dtype=int), np.array([[3,3,3,3,3],[3,0,0,0,3],[3,0,3,0,3],[3,0,0,0,3],[3,3,3,3,3]], dtype=int)),
    ("⧎(⇒(∅, IV), ∧(◎(∅), ¬(⏚(∅))), Ⳁ)", np.array([[0,0,0],[0,1,0],[0,0,0]], dtype=int), np.array([[0,0,0],[0,1,0],[0,0,0]], dtype=int)),
    ("⧎(⇒(∅, IV), ∧(◎(∅), ¬(⏚(∅))), Ⳁ)", np.array([[0,0,0,0,0],[0,3,3,3,0],[0,3,0,3,0],[0,3,3,3,0],[0,0,0,0,0]], dtype=int), np.array([[0,0,0,0,0],[0,3,3,3,0],[0,3,0,3,0],[0,3,3,3,0],[0,0,0,0,0]], dtype=int)),
    ("ⓑ(Ⳁ)", np.array([[0,0],[0,0]], dtype=int), np.array([[0,0],[0,0]], dtype=int)),
    ("ⓑ(Ⳁ)", np.array([[1,1],[1,1]], dtype=int), np.array([[1,1],[1,1]], dtype=int)),
    ("ⓑ(Ⳁ)", np.array([[7,7],[7,7]], dtype=int), np.array([[1,1],[1,1]], dtype=int)),
    ("⏚(∅)", np.array([[0,0,0,0,0],[0,3,3,3,0],[0,3,0,3,0],[0,3,3,3,0],[0,0,0,0,0]], dtype=int), np.array([[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]], dtype=int)),
    ("∨(⏚(∅), ⓑ(◎(III)))", np.array([[0,0,0,0,0],[0,3,3,3,0],[0,3,0,3,0],[0,3,3,3,0],[0,0,0,0,0]], dtype=int), np.array([[1,1,1,1,1],[1,1,1,1,1],[1,1,0,1,1],[1,1,1,1,1],[1,1,1,1,1]], dtype=int)),
    ("⟹(∨(⏚(∅), ⓑ(◎(III))), ⟹(⇒(∅, IV), ⇒(I, ∅)))",  np.array([[0,0,0,0,0],[0,3,3,3,0],[0,3,0,3,0],[0,3,3,3,0],[0,0,0,0,0]], dtype=int), np.array([[0,0,0,0,0],[0,0,0,0,0],[0,0,4,0,0],[0,0,0,0,0],[0,0,0,0,0]], dtype=int)),

    ("⏚(∅)",
     np.array([[0,0,0,0,0],[0,3,3,3,0],[0,3,0,3,0],[0,3,3,3,0],[0,0,0,0,0]], dtype=int),
     np.array([[1,1,1,1,1],[1,0,0,0,1],[1,0,0,0,1],[1,0,0,0,1],[1,1,1,1,1]], dtype=int)),
    ("ⓑ(◎(III))",
     np.array([[0,0,0,0,0],[0,3,3,3,0],[0,3,0,3,0],[0,3,3,3,0],[0,0,0,0,0]], dtype=int),
     np.array([[0,0,0,0,0],[0,1,1,1,0],[0,1,0,1,0],[0,1,1,1,0],[0,0,0,0,0]], dtype=int)),
    ("∨(⏚(∅), ⓑ(◎(III)))",
     np.array([[0,0,0,0,0],[0,3,3,3,0],[0,3,0,3,0],[0,3,3,3,0],[0,0,0,0,0]], dtype=int),
     np.array([[1,1,1,1,1],[1,1,1,1,1],[1,1,0,1,1],[1,1,1,1,1],[1,1,1,1,1]], dtype=int)),
    ("⟹(⌂, ⟹(⇒(∅, IV), ⇒(I, ∅)))",
     np.array([[0,1,0],[1,0,1],[0,1,0]], dtype=int),
     np.array([[4,0,4],[0,4,0],[4,0,4]], dtype=int)),
    ("⟹(∨(⏚(∅), ⓑ(◎(III))), ⟹(⇒(∅, IV), ⇒(I, ∅)))",
     np.array([[0,0,0,0,0],[0,3,3,3,0],[0,3,0,3,0],[0,3,3,3,0],[0,0,0,0,0]], dtype=int),
     np.array([[0,0,0,0,0],[0,0,0,0,0],[0,0,4,0,0],[0,0,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("⧎(⌂,∨(⏚(∅),ⓑ(◎(III))),⟹(∨(⏚(∅),ⓑ(◎(III))),⟹(⇒(∅,IV),⇒(I,∅))))",
     np.array([[0,0,0,0,0],[0,3,3,3,0],[0,3,0,3,0],[0,3,3,3,0],[0,0,0,0,0]], dtype=int),
     np.array([[0,0,0,0,0],[0,3,3,3,0],[0,3,4,3,0],[0,3,3,3,0],[0,0,0,0,0]], dtype=int)),
    ("⌖(⊕(I,I,V), ⊕(I,I,V))", None, np.array([[1]], dtype=int)),
    ("⌖(⊕(II,II,I), ⊕(I,I,I))", None, np.array([[1,1],[1,1]], dtype=int)),
    ("⌖(⊕(II,II,I), ⊕(I,I,V))", None, np.array([[0,0],[0,0]], dtype=int)),
    ("⌖(⊕(III,III,I), ▦(II,II,[[I,I],[I,I]]))", None, np.array([[1,1,1],[1,1,1],[1,1,1]], dtype=int)),
    ("⌖(⊕(III,III,I), ▦(II,II,[[?,?],[?,?]]))", None, np.array([[1,1,1],[1,1,1],[1,1,1]], dtype=int)),
    ("⌖(⊕(III,III,I), ▦(II,II,[[I,?],[?,I]]))", None, np.array([[1,1,1],[1,1,1],[1,1,1]], dtype=int)),
    ("⌖(⊕(IV,IV,I), ▦(II,II,[[?,I],[I,?]]))", None, np.array([[1,1,1,1],[1,1,1,1],[1,1,1,1],[1,1,1,1]], dtype=int)),
    ("⌖(⊕(III,III,I), ▦(III,III,[[?,I,?],[I,?,I],[?,I,?]]))", np.array([[0,1,0],[1,2,1],[0,1,0]], dtype=int), np.array([[1,1,1],[1,1,1],[1,1,1]], dtype=int)),
    ("⌖(⊕(III,III,I), ▦(II,II,[[I,I],[I,I]]))", np.array([[1,1,0],[1,1,0],[0,0,0]], dtype=int), np.array([[1,1,1],[1,1,1],[1,1,1]], dtype=int)),
    ("⌖(⊕(V,V,I), ▦(II,II,[[?,?],[?,?]]))", None, np.array([[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1],[1,1,1,1,1]], dtype=int)),
    ("⌖(⊕(III,III,I), ▦(II,II,[[∅,∅],[∅,∅]]))", None, np.array([[0,0,0],[0,0,0],[0,0,0]], dtype=int)),
    ("⌖(⊕(II,II,V), ▦(II,II,[[V,V],[V,V]]))", None, np.array([[1,1],[1,1]], dtype=int)),
    ("⌖(⊕(II,II,V), ▦(II,II,[[I,I],[I,I]]))", None, np.array([[0,0],[0,0]], dtype=int)),
    ("⌖(⊕(II,II,V), ▦(III,III,[[V,V,V],[V,V,V],[V,V,V]]))", None, np.array([[0,0],[0,0]], dtype=int)),
    ("⌖(⊕(II,II,V), ▦(I,I,[[?]]))", None, np.array([[1,1],[1,1]], dtype=int)),
    ("⌖(⌂, ▦(II,II,[[?,?],[?,?]]))", np.array([[1,2,3],[4,5,6],[7,8,9]], dtype=int), np.array([[1,1,1],[1,1,1],[1,1,1]], dtype=int)),
    ("⌖(⌂, ▦(I,I,[[5]]))", np.array([[1,2,3],[4,5,6],[7,8,9]], dtype=int), np.array([[0,0,0],[0,1,0],[0,0,0]], dtype=int)),
    ("⌖(⌂, ▦(II,II,[[5,?],[?,9]]))", np.array([[1,2,3],[4,5,6],[7,8,9]], dtype=int), np.array([[0,0,0],[0,1,1],[0,1,1]], dtype=int)),
    ("⌖(⌂, ▦(II,II,[[?,?],[?,?]]))", np.array([[0,0,0],[0,1,0],[0,0,0]], dtype=int), np.array([[1,1,1],[1,1,1],[1,1,1]], dtype=int)), 
    ("⌖(⌂, ▦(I,I,[[1]]))", tiny_grid_1x1_val1, tiny_grid_1x1_val1),
    ("⌖(⌂, ▦(I,I,[[2]]))", tiny_grid_1x1_val1, np.array([[0]], dtype=int)),
    ("⌖(⌂, ▦(II,II,[[?,?],[?,?]]))", tiny_grid_1x1_val1, np.array([[0]], dtype=int)),
    ("⌖(⌂, ▦(III,III,[[II,II,II],[II,∅,II],[II,II,II]]))", np.array([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]], dtype=int), np.array([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]], dtype=int)),
    ("⧎(⇒(∅, VIII), ⌖(⌂, ▦(III,III,[[II,II,II],[II,∅,II],[II,II,II]])), ⌂)", np.array([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]], dtype=int), np.array([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,8,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]], dtype=int)),
    ("⌖(⌂, ▦(IX,IX,[[II,II,II,II,II,II,II,II,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,II,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,II,II,II,II,II,II,II,II]]))", np.array([[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,2,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]], dtype=int), np.array([[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]], dtype=int)),
    ("⌖(⌂, ▦(IX,IX,[[II,II,II,II,II,II,II,II,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,II,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,II,II,II,II,II,II,II,II]]))", np.array([[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,2,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]], dtype=int), np.array([[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,1,1,1,1,1,1,1,1,1],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]], dtype=int)),
    ("⌖(⌂, ▦(III,III,[[II,II,II],[II,∅,II],[II,II,II]]))", np.array([[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,2,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]], dtype=int), np.array([[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,1,1,1,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]], dtype=int)) ,       
    ("⧎(⇒(∅,VIII),⌖(⌂,▦(III,III,[[II,II,II],[II,∅,II],[II,II,II]])),⧎(⇒(∅,III),⌖(⌂,▦(IX,IX,[[II,II,II,II,II,II,II,II,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,II,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,∅,∅,∅,∅,∅,∅,∅,II],[II,II,II,II,II,II,II,II,II]])),⌂))", np.array([[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,2,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,0,0,0,0,0,0,0,2],[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,0,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]], dtype=int), np.array([[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,2,3,3,3,3,3,3,3,2],[0,0,0,0,0,0,2,3,3,3,3,3,3,3,2],[0,0,0,0,0,0,2,3,3,3,3,3,3,3,2],[0,0,0,0,0,0,2,3,3,3,2,3,3,3,2],[0,0,0,0,0,0,2,3,3,3,3,3,3,3,2],[0,0,0,0,0,0,2,3,3,3,3,3,3,3,2],[0,0,0,0,0,0,2,3,3,3,3,3,3,3,2],[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,2,2,2,2,2,2,2,2,2],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,8,2,0,0,0,0,0,0,0,0,0,0],[0,0,2,2,2,0,0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]], dtype=int)),
    ("✂(I,I,II,II)", common_input_grid, np.array([[1, 2], [4, 5]], dtype=int)),
    ("✂(I,II,III,II)", common_input_grid, np.array([[2], [5], [8]], dtype=int)),
    ("✂(I,I,III,III)", common_input_grid, np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]], dtype=int)),
    ("✂(I,I,II,II)", asymmetric_grid, np.array([[1, 2], [3, 4]], dtype=int)),
    ("✂(II,II,III,III)", asymmetric_grid, np.array([[4, 0], [0, 0]], dtype=int)),
    ("✂(I,III,I,III)", asymmetric_grid, np.array([[0]], dtype=int)),
    ( "↔(✂(I,I,II,III))", np.array([[1,2,3],[4,5,6],[7,8,9]], dtype=int), np.array([[3,2,1],[6,5,4]], dtype=int)),
    ( "⟹(✂(I,I,III,III), ⇒(I,V))", np.array([[1,1,1],[0,1,0],[1,1,1]], dtype=int), np.array([[5,5,5],[0,5,0],[5,5,5]], dtype=int)),
    ( "⟹(✂(I,I,II,II), ◎(III))", np.array([[1,2,7],[4,5,8],[7,8,9]], dtype=int), np.array([[0,0],[0,0]], dtype=int)),
    ( "⧈(✂(I,I,IV,IV))", np.array([[0,0,0,0],[0,1,2,0],[0,3,4,0],[0,0,0,0]], dtype=int), np.array([[1,2],[3,4]], dtype=int)),
    ( "⟹(✂(II,I,II,III), ⬒(II))", np.array([[1,2,3],[4,5,6],[7,8,9]], dtype=int), np.array([[4,5,6],[4,5,6]], dtype=int)),
    ( "↕(✂(I,II,II,III))", np.array([[1,2,3],[4,5,6],[7,8,9]], dtype=int), np.array([[5,6],[2,3]], dtype=int)),
    ( "⟹(✂(II,II,II,II), ⟹(⬒(II), ◨(II)))", np.array([[1,2,3],[4,5,6],[7,8,9]], dtype=int), np.array([[5,5],[5,5]], dtype=int)),
    ("■(⊕(III, III, ∅), I, I, I, II, II)", np.array([[0]], dtype=int), np.array([[1, 1, 0], [1, 1, 0], [0, 0, 0]], dtype=int)),
    ("■(⊕(IV, IV, ∅), V, III, III, IV, IV)", np.array([[0]], dtype=int), np.array([[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 5, 5], [0, 0, 5, 5]], dtype=int)),
    ("■(⊕(III, III, I), ∅, I, I, III, III)", np.array([[0]], dtype=int), np.array([[0, 0, 0], [0, 0, 0], [0, 0, 0]], dtype=int)),
    ("■(⊕(III, III, ∅), II, I, II, III, II)", np.array([[0]], dtype=int), np.array([[0, 2, 0], [0, 2, 0], [0, 2, 0]], dtype=int)),
    ("■(Ⳁ,  ∅, I, I, II, II)", np.array([[1, 2, 3], [4, 5, 6], [7, 8, 9]], dtype=int), np.array([[0, 0, 3], [0, 0, 6], [7, 8, 9]], dtype=int)),
    ("■(⊕(II, II, ∅), I, II, II, I, I)", np.array([[0]], dtype=int), np.array([[0, 0], [0, 0]], dtype=int)),
    ("⊞(⊕(II,II,∅), ⊕(I,I,I), ∅, ∅)", None, np.array([[1, 0], [0, 0]], dtype=int)),
    ("⊞(⊕(II,II,∅), ⊕(I,II,I), ∅, ∅)", None, np.array([[1, 1], [0, 0]], dtype=int)),
    ("⊞(⊕(II,II,∅), ⊕(II,I,I), ∅, ∅)", None, np.array([[1, 0], [1, 0]], dtype=int)),
    ("⊞(⊕(II,II,∅), ⊕(II,II,I), ∅, ∅)", None, np.array([[1, 1], [1, 1]], dtype=int)),
    ("⊞(⌂, ⊕(I,I,V), ∅, ∅)", np.array([[0, 0], [0, 0]], dtype=int), np.array([[5, 0], [0, 0]], dtype=int)),
    ("⊞(⌂, ⊕(I,I,V), I, I)", np.array([[0, 0], [0, 0]], dtype=int), np.array([[0, 0], [0, 5]], dtype=int)),
    ("⊞(⌂, ⊕(I,II,V), I, ∅)", np.array([[0, 0], [0, 0]], dtype=int), np.array([[0, 0], [5, 5]], dtype=int)),
    ("⊞(⊕(III,III,∅), ⌂, ∅, ∅)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[1, 2, 0], [3, 4, 0], [0, 0, 0]], dtype=int)),
    ("⊞(⊕(III,III,V), ⌂, I, I)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[5, 5, 5], [5, 1, 2], [5, 3, 4]], dtype=int)),
    ("⊞(⊕(IV,IV,∅), ⌂, II, II)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 1, 2], [0, 0, 3, 4]], dtype=int)),
    ("⊞(⊕(III,III,∅), ⊕(I,I,I), I, I)", None, np.array([[0, 0, 0], [0, 1, 0], [0, 0, 0]], dtype=int)),
    ("⊞(⊕(III,III,∅), ⊕(I,I,I), II, I)", None, np.array([[0, 0, 0], [0, 0, 0], [0, 1, 0]], dtype=int)),
    ("⊞(⊕(III,III,∅), ⊕(I,I,I), I, II)", None, np.array([[0, 0, 0], [0, 0, 1], [0, 0, 0]], dtype=int)),
    ("⊞(⊕(III,III,∅), ⊕(II,II,X), I, I)", None, np.array([[0, 0, 0], [0, 10, 10], [0, 10, 10]], dtype=int)),
    ("⊞(⊕(II,II,∅), ⊕(I,I,I), I, I)", None, np.array([[0,0],[0,1]], dtype=int)),
    ("⊞(⊕(II,II,I), ⊕(I,I,V), ∅, ∅)", None, np.array([[5, 1], [1, 1]], dtype=int)),
    ("⊞(⊕(II,II,I), ⊕(I,I,V), I, I)", None, np.array([[1, 1], [1, 5]], dtype=int)),
    ("⊞(⊕(II,II,I), ⊕(II,II,V), I, I)", None, np.array([[1, 1], [1, 5]], dtype=int)),
    ("⊞(⊕(II,II,∅), ⊕(III,III,I), ∅, ∅)", None, np.array([[1, 1], [1, 1]], dtype=int)),
    ("⊞(⊕(II,II,∅), ⊕(III,III,I), I, I)", None, np.array([[0,0],[0,1]], dtype=int)),
    ("⊞(⌂, ⊕(III,III,I), ∅, ∅)", np.array([[0,0],[0,0]], dtype=int), np.array([[1, 1], [1, 1]], dtype=int)),
    ("⊞(⊕(II,II,∅), ⊕(I,I,I), ∅, -I)", None, np.array([[0,0],[0,0]], dtype=int)),
    ("⊞(⊕(II,II,∅), ⊕(I,I,I), -I, ∅)", None, np.array([[0,0],[0,0]], dtype=int)),
    ("⊞(⊕(II,II,I), ⊕(I,I,V), ∅, -I)", None, np.array([[1,1],[1,1]], dtype=int)),
    ("⊞(Ⳁ, Ⳁ, ∅, ∅)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[1, 2], [3, 4]], dtype=int)),
    ("⊞(⊕(III,III,∅), Ⳁ, I, I)", np.array([[1]], dtype=int), np.array([[0, 0, 0], [0, 1, 0], [0, 0, 0]], dtype=int)),
    ("⊞(⊕(III,III,∅), Ⳁ, II, II)", np.array([[1, 2], [3, 4]], dtype=int), np.array([[0, 0, 0], [0, 0, 0], [0, 0, 1]], dtype=int)),
    ("⊞(⊕(V,V,∅), ⊕(II,II,VII), I, II)", None, np.array([[0,0,0,0,0],[0,0,7,7,0],[0,0,7,7,0],[0,0,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("⊞(⊕(II,II,V), ⊕(I,I,I), ∅, ∅)", None, np.array([[1,5],[5,5]], dtype=int)),
    ("⊞(⊕(II,II,V), ⊕(I,I,I), I, I)", None, np.array([[5,5],[5,1]], dtype=int)),
    ("⊞(⊕(II,II,∅), ⊕(II,II,I), -I, -I)", np.array([[0,0],[0,0]], dtype=int), np.array([[1,0],[0,0]], dtype=int)),
    ("⊞(⊕(II,II,∅), ⊕(II,II,I), -I, ∅)", np.array([[0,0],[0,0]], dtype=int), np.array([[1,1],[0,0]], dtype=int)),
    ("⊞(⊕(II,II,∅), ⊕(II,II,I), ∅, -I)", np.array([[0,0],[0,0]], dtype=int), np.array([[1,0],[1,0]], dtype=int)),
    ("⊕(IX, III, ∅)", None, np.array([[0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]], dtype=int)),
    ("⊞(⊕(IX, III, ∅), ⌂, ∅, ∅)", np.array([[0, 1, 0], [1, 1, 0], [0, 1, 0], [0, 1, 1], [0, 1, 0], [1, 1, 0]], dtype=int), np.array([[0, 1, 0], [1, 1, 0], [0, 1, 0], [0, 1, 1], [0, 1, 0], [1, 1, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]], dtype=int)),
    ("⧈(⌂)", np.array([[0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 2, 2, 2, 0, 0, 0, 0], [0, 0, 2, 0, 0, 2, 0, 0, 0], [0, 0, 0, 2, 2, 2, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0]], dtype=int), np.array([[2, 2, 2, 0], [2, 0, 0, 2], [0, 2, 2, 2]], dtype=int)),
    ("⊞(⊕(V,IX,∅), ◎(II), ∅, -I)", np.array([[0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 0, 2, 2, 2, 0, 0, 0, 0], [0, 0, 2, 0, 0, 2, 0, 0, 0], [0, 0, 0, 2, 2, 2, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0]], dtype=int), np.array([[0, 0, 0, 0, 0, 0, 0, 0, 0], [0, 2, 2, 2, 0, 0, 0, 0, 0], [0, 2, 0, 0, 2, 0, 0, 0, 0], [0, 0, 2, 2, 2, 0, 0, 0, 0], [0, 0, 0, 0, 0, 0, 0, 0, 0]], dtype=int)),
    ("⚇(I, I)", np.array([[1,1,0,1,0],[1,1,0,0,0],[0,0,0,0,0]], dtype=int), np.array([[1,1,0,0,0],[1,1,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("⚇(I, I)", np.array([[1,1,0,1,0],[1,1,0,0,0],[0,0,0,0,0]], dtype=int), np.array([[1,1,0,0,0],[1,1,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("⚇(II, II)", np.array([[0,1,0,0,0],[0,1,1,0,1],[0,0,0,0,1]], dtype=int), np.array([[0,1,0,0,0],[0,1,1,0,0],[0,0,0,0,0]], dtype=int)),
    ("⚇(I, IV)", np.array([[1,1,0,2,2],[1,0,0,2,0],[0,0,3,3,3]], dtype=int), np.array([[0,0,0,2,2],[0,0,0,2,0],[0,0,0,0,0]], dtype=int)),
    ("⚇(I, III)", np.array([[0,1,0,0,0],[0,1,1,0,1],[0,0,0,0,1]], dtype=int), np.array([[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("⚇(II, II)", np.array([[0,0,0,0,0],[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0]], dtype=int), np.array([[0,0,0,0,0],[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("⚇(I, I)", np.array([[1,1,0,1,0],[1,1,0,0,0],[0,0,0,0,0]], dtype=int), np.array([[1,1,0,0,0],[1,1,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("⚇(II, II)", np.array([[0,1,0,0,0],[0,1,1,0,1],[0,0,0,0,1]], dtype=int), np.array([[0,1,0,0,0],[0,1,1,0,0],[0,0,0,0,0]], dtype=int)),
    ("⚇(I, IV)", np.array([[1,1,0,2,2],[1,0,0,2,0],[0,0,3,3,3]], dtype=int), np.array([[0,0,0,2,2],[0,0,0,2,0],[0,0,0,0,0]], dtype=int)),
    ("⚇(I, III)", np.array([[0,1,0,0,0],[0,1,1,0,1],[0,0,0,0,1]], dtype=int), np.array([[0,0,0,0,0],[0,0,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("⚇(II, II)", np.array([[0,0,0,0,0],[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0]], dtype=int), np.array([[0,0,0,0,0],[0,1,0,0,0],[1,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("⚇(II,II)", np.array([[0,0,0,0,0],[0,1,1,0,0],[0,1,0,2,0],[0,0,0,0,0]], dtype=int), np.array([[0,0,0,0,0],[0,1,1,0,0],[0,1,0,0,0],[0,0,0,0,0]], dtype=int)),
    ("⚇(III,V)", np.array([[1,1,0,0,0],[0,1,0,2,2],[0,0,0,3,3],[0,0,0,0,3]], dtype=int), np.array([[0,0,0,0,0],[0,0,0,0,0],[0,0,0,3,3],[0,0,0,0,3]], dtype=int)),
    ("⊞(⌂, ⚇(II,II), ∅, II)", np.array([[0,0,0,0,0,0,0,0,0],[0,2,2,0,0,0,0,0,0],[0,2,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,2,2,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0]], dtype=int), np.array([[0,0,0,0,0,0,0,0,0],[0,2,2,2,2,0,0,0,0],[0,2,2,2,2,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,2,2,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,2,0,0]], dtype=int)),
    ("⊞(⌂, ⚇(I,I), ∅, ∅)", np.array([[5, 6, 7], [8, 9, 0], [1, 2, 3]], dtype=int), np.array([[5, 6, 7], [8, 9, 0], [1, 2, 3]], dtype=int)),
    ("⊞(⌂, ⚇(II,II), ∅, ∅)", np.array([[7,7,7],[7,1,7],[7,7,7]], dtype=int), np.array([[7,7,7],[7,1,7],[7,7,7]], dtype=int)),
    ("⊞(⌂, ⚇(II,II), I, I)", np.array([[5,5,5,5],[5,1,1,5],[5,1,1,5],[5,5,5,5]], dtype=int), np.array([[5,5,5,5],[5,1,1,5],[5,1,1,1],[5,5,1,1]], dtype=int)),
    ("⊞(⌂, ⚇(IV,V), ∅, II)", np.array([[0,0,2,2,0,0,0,0,0],[0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,2,0,0,0,0]], dtype=int), np.array([[0,0,2,2,0,0,0,0,0],[0,0,2,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,2,0,2,0,0]], dtype=int)),
    ("│(⌂)", np.array([[1,2,3,4,5],[6,7,8,9,0],[1,2,3,4,5]], dtype=int), 3),
    ("─(⌂)", np.array([[1,2,3,4,5],[6,7,8,9,0],[1,2,3,4,5]], dtype=int), 5),
    ("│(⌂)", np.array([[1],[2],[3],[4],[5],[6]], dtype=int), 6),
    ("─(⌂)", np.array([[1,1,1,1,1,1,1]], dtype=int), 7),
    ("⊕(│(⌂), ─(⌂), ∅)", np.array([[1,2],[3,4],[5,6]], dtype=int), np.array([[0,0],[0,0],[0,0]], dtype=int)),
    ("⊕(│(⌂),↱V, I)", np.array([[1,2,3],[4,5,6]], dtype=int), np.array([[1,1,1,1,1],[1,1,1,1,1]], dtype=int)),
    ("⊕(↱III, ─(⌂), II)", np.array([[1,1],[2,2],[3,3],[4,4]], dtype=int), np.array([[2,2],[2,2],[2,2]], dtype=int)),
    ("⊕(│(⌂), ─(⌂), IX)", np.array([[5]], dtype=int), np.array([[9]], dtype=int)),

]

@pytest.fixture
def parser() -> SymbolicRuleParser:
    return SymbolicRuleParser()

@pytest.fixture
def test_logger() -> logging.Logger:
    return logging.getLogger(__name__)



@pytest.mark.parametrize("rule, initial_input_grid, expected_output", TEST_CASES)
def test_dsl_executor_execution(
    parser: SymbolicRuleParser,
    test_logger: logging.Logger,
    rule: str,
    initial_input_grid: Optional[np.ndarray],
    expected_output: Union[np.ndarray, int] # Changed type hint to accept both
):
    try:
        parsed_command_tree = parser.parse_rule(rule)
        test_logger.info(f"Successfully parsed rule: '{rule}'")

        if initial_input_grid is None:
            executor_input_grid = np.array([[0]], dtype=int)
        else:
            executor_input_grid = np.array(initial_input_grid, dtype=int)

        executor = DSLExecutor(
            root_command=parsed_command_tree,
            initial_puzzle_input=executor_input_grid,
            logger=test_logger
        )
        test_logger.info("Executor instantiated and initialized commands.")

        result = executor.execute_program()
        test_logger.info(f"Execution complete for rule: '{rule}'")

        if isinstance(expected_output, np.ndarray):
            assert isinstance(result, np.ndarray), \
                f"Type mismatch for rule '{rule}': Expected np.ndarray, got {type(result)}"
            assert result.shape == expected_output.shape, \
                f"Shape mismatch for rule '{rule}': {result.shape} vs {expected_output.shape}"
            assert np.array_equal(result, expected_output), \
                f"Output mismatch for rule '{rule}'\nExpected:\n{expected_output}\nGot:\n{result}"
        elif isinstance(expected_output, int):
            assert isinstance(result, int), \
                f"Type mismatch for rule '{rule}': Expected int, got {type(result)}"
            assert result == expected_output, \
                f"Output mismatch for rule '{rule}'\nExpected: {expected_output}\nGot: {result}"
        else:
            pytest.fail(f"Invalid expected_output type in test case for rule '{rule}': {type(expected_output)}")

    except Exception as e:
        pytest.fail(f"Test failed for rule '{rule}': {str(e)}")